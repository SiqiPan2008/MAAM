\documentclass{article}
\usepackage{ctex}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{caption}
\RequirePackage{longtable,multirow,array}
\RequirePackage{booktabs}
\usepackage{booktabs}
\usepackage{multicol}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage[style=ieee,sorting=nyt]{biblatex}
\assignrefcontextentries[]{*}
\addbibresource{References.bib}
\geometry{left=1in, right=1in, top=1in, bottom=1in}
\hypersetup{hidelinks}
\hypersetup{bookmarksnumbered=true,
	bookmarksopen=true,
	colorlinks=true,
	linkcolor=black,
	citecolor=blue,
	urlcolor=black}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{mhchem}
\pgfplotsset{compat=1.18}
\captionsetup{justification=centering}
\captionsetup[figure]{name={Fig.},labelsep=space,labelfont=bf}
\captionsetup[table]{name={Table},labelsep=space,labelfont=bf}
\CTEXoptions[today=old, contentsname=Contents]
\newcommand{\authyear}[1]{\citeauthor{#1} (\citeyear{#1})}
\setmainfont{Arial}

\newcommand{\toB}[1]{\color{blue}#1\color{black}}

\begin{document}
	\title{\vspace{-2.25cm} Development of Ocular Disease Auxiliary Diagnosis System}
	\author{Jerry Pan}
	\date{}
	\maketitle
	
	\vspace{0.5cm}
	\tableofcontents
	
	\pagebreak
	
	\section{Background}
	
		Ocular diseases can be diagnosed through various methods, including using optical coherence tomography (OCT) and color fundus images. Ophthalmologists usually identify ocular abnormalities to deduce the disease.  Traditionally, the diagnosis primarily depends on the professional experience and knowledge of the ophthalmologists, which may result in high misdiagnosis rate and under-utilization of medical data.  With the widespread application of artificial intelligence (AI), deep learning (DL) has made great contributions in providing support to patients in remote areas by sharing expert knowledge \autocite{Ichhpujani_Thakur_2021}.  By leveraging DL, researchers have developed auxiliary diagnosis programs to help doctors in the process. Many studies use convolutional neural network (CNN) to analyze ocular images. Some commonly used CNNs are VGG16, ResNet50, and Inception \autocite{daich2023artificial}.  And for segmenting images and finding abnormalities, U-net is widely used \autocite{Ronneberger_Fischer_Brox_2015}. In training CNNs, most studies use transferred learning, which consists of three steps: learning, fine-tuning, and validation.
		
		Some studies directly predict the disease from OCT images.
		\authyear{li2019deep} used ResNet to analyze OCT images and distinguish between choroidal neovascularization (CNV), diabetic macular edema (DME), drusen, and normal eyes. In addition, they performed occlusion testing to find out the regions that are the most important in diagnosis \autocite{li2019deep}. 
		\authyear{yoo2021feasibility} used generative adversarial network (GAN) and Inception-v3 together with a few-shot dataset to investigate the feasibility of improving OCT diagnosis of rare ocular diseases \autocite{yoo2021feasibility}.  They cleverly handled the issues of training image shortage and data imbalance by creating ocular disease OCT images from healthy OCT images. \authyear{Kermany2018} conducts medical diagnosis and identifies treatable diseases by image-based deep learning.  They also provided a widely used database including more than one hundred thousand OCT labeled images for 3 diseases \autocite{Kermany2018}.
		
		Some other studies can identify ocular abnormalities from annotated OCT images.
		\authyear{camino2018deep} used DL to identify the region of preserved photoreceptors on \textit{en face} OCT in choroideremia and retinitis pigmentosa (RP) \autocite{camino2018deep}. 
		\authyear{srinivasan2014fully} detected DME and dry age-related macular degeneration (dry AMD) from OCT images by flattening the image and using support vector machine (SVM) to extract the thickness information of the retinal layers \autocite{srinivasan2014fully}. 
		\authyear{leandro2023oct} implemented VGG to identify up to 8 kinds of key abnormalities and hence detect multiple diseases by using central fovea cross-section OCT \autocite{leandro2023oct}.  \authyear{Fang_Wang2019} developed a novel lesion-aware CNN, called LACNN, to simulate the ophthalmologists' diagnosis that focuses on ocular abnormalities.  The LACNN is a U-net-like CNN which incorporates VGG16 as the baseline, and the result is impressive \autocite{Fang_Wang2019}.
		
		Other studies use fundus images to predict ocular diseases.
		\authyear{masumoto2019accuracy} trained deep CNN with ultrawide-field fundus images to make the CNN capable of diagnosing RP \autocite{masumoto2019accuracy}. 
		\authyear{chen2021artificial} uses color fundus photographs and multiple types of CNN (Inception V3, Inception Resnet V2, and Xception) to develop a method of early detection of RP \autocite{chen2021artificial}. 
		\authyear{li2022development} uses CNN to detect up to 12 fundus diseases based on colour fundus photography \autocite{li2022development}.  \authyear{Son2023} presented a novel architectural and algorithmic design to comprehensively identify 15 abnormalities and diagnose 8 major ocular diseases from macula-centered fundus images.  They defined a notion of counterfactual attribution ratio (CAR) to interpret the system's diagnostic reason and disclose the relationship between abnormalities and diseases \autocite{Son2023}.
		
		In recent years, more and more DL systems began to use multi-modal information to predict ocular diseases.  For automated detection system, retrieving features from both OCT images and fundus images can effectively keep the diagnosis away from bias and incompleteness.  It is not always necessary to yield a better automated diagnosis result, but it does help ophthalmologist to make more accurate and holistic clinical decisions.  For instance, \authyear{liu2023prediction} combined OCT and fundus images to evaluate visual impairment in RP in terms of best-corrected visual acuity(BCVA) \autocite{liu2023prediction}.  \authyear{Xu2021} leveraged a bi-modal CNN to diagnose AMD and polypoidal choroidal vasculopathy (PCV), where the architecture uses fundus and OCT images as input for transferred learning CNN and concatenates the retrieved features to classify 3 diseases including dry AMD, wet AMD and PCV \autocite{Xu2021}.  And \author{Andrearczyk2018} ingeniously combined medical images and biomedical textual information to discriminate different diseases, which is a novel method for the usage of multi-modal application \autocite{Andrearczyk2018}.
		
		The key technical problem of multi-modal diagnosis is how to fuse the results from multifarious sources.  There are three types of fusion, namely early, late, and hybrid fusion.  Deciding on the optimal type of fusion is part of the exploratory process in the application of DL methods \autocite{Ichhpujani_Thakur_2021}.
		
		
	
	\section{Model Overview}
		
		The Optical Disease Auxiliary Diagnosis System (ODADS)
		Model purpose: recognize abnormities, then diagnose disease; 
		interpretable findings 
		
		
		
		Fig: OCT abnormities
		Fig: Fundus abnormities
		
		\begin{itemize}
			\item Branch retinal vein occlusion (BRVO) or hemicentral retinal vein occlusion (HCRVO)
			
			\item Central retinal vein occlusion (CRVO)
			
			\item Central serous chorioretinopathy (CSC)
			
			\item Dry age-related macular dystrophy (dry AMD)
			
			\item Epiretinal membrane (ERM)
			
			\item Macular hole (MH)
			
			\item Macular telangiectasia (Mactel)
			
			\item Mild diabetic retinopathy (mild DR)
			
			\item Referable diabetic retinopathy (referable DR)
			
			\item Retinitis pigmentosa (RP)
			
			\item Stargardt disease (Stargardt)
			
			\item Wet age-related macular dystrophy (wet AMD)
		\end{itemize}
		
		No real data. use the following criteria
		
		Fig: From Abnormity to Disease
		
		Model consists of 3 parts: OCT-Model, Fundus-Model, and Diagnosis-Model. OCT-Model and Fundus-Model are collectively called the Abnormity-Models. They use the same architecture (ResNet152, flatten to 2048 features, and fc). Diagnosis Model consists of #num submodels, one of which is for normal, and the other ones for each disease. each submodel first fuses output from both Abnormity-Models, then uses an fc to get final results for normal or for the disease. 
		
		Fig: 3 parts
		
		fusion: max of OCT, max of fundus, concatenate
		
		Fig: fusion
		
		how to find grade (number of traits = grade for the disease as label during training), output - calculate expected grade. in order to compare, divide by total number of traits for this disease so that normalized grade falls in [0, 1]. )
		
	\section{Abnormity Models}
	
		\subsection{Data Preparation}
		
			Table: Data source for OCT
				numbered list of sources
				columns for source number, final column = total number of imgs
				rows for abnormities
			
			CycleGAN
				Fig: Intro
				Table: selection rates
				selection criteria
				
			transforms for OCT
				for train: copy, flip, randomcomb1
				for test: copy, flip, randomcomb2 -> explain truthfulness
				
				
				
			Table: Data source for Fundus - same as OCT
				
			Why I did not GAN Fundus
			
			transforms for Fundus
				similar to OCT
				explain differences
			
		\subsection{Training}
			
			intro to five-fold train/valid (reason for using this?)
			
			starting point of fine-tuning???????????????????????????????
			prevent overfitting
			
			crossentropyloss, ADAM optimizer with LR 1e-3, batchSize 16, number of epochs...
			
			conda, PyTorch;
			desktop computer with Intel® Xeon® Platinum 8352V Processor, 256G of RAM and 2 NVIDIA GPU (GeForce RTX 4090) with 48 VRAM
			
		\subsection{Results}
			
			For both OCT and Fundus:
			
				Fig: accuracy and loss over epochs
					trainAcc, validAcc, trainLosses, validLosses
					testAcc for best weights - align below acc graph
					
				Table: for each abnormity:
					accuracy (only present accuracy for TOTAL)
					precision
					recall/sensitivity
					specificity
					F1
					AUC
					
				Table: Confusion matrix
					analyze which abnormities are commonly confused, and the effect on the numerical results
				Fig: t-SNE
					which abnormities are "close"
				
				Fig: ROC for each abnormity
				
			"co-dominance"??????????????????????????????
				
			Fig: GradCAM intro
			Fig: GradCAM example
		
	\section{Diagnosis Model}
	
		\subsection{Data Preparation}
		
			how to choose data (with an example)
			
		
		\subsection{Training}
		
			parameters used
		
		\subsection{Results}
			
			Do two models increase accuracy?
				how do I compare?????????????????????????????????
				any math here?
			
			Fig: accuracy and loss over epochs
				trainAcc, validAcc, trainLosses, validLosses
			Table: for each disease:
				accuracy (only present accuracy for TOTAL)
				precision
				recall/sensitivity
				specificity
				F1
				AUC
			Fig: ROC for each disease
	
			"co-dominance"???????????????????????????????????
	
	\section{Conclusion}
	
		Comparison
		
		Strengths and weaknesses
	
	\section{Appendix}
	
		Google Image source links
		Add prevalence (1 out of how many people) for abnormities?
		
		{
			\fontsize{9}{12}\selectfont
			{
				\begin{longtable}{lp{3.8in}}
					\caption{OCT Abnormities}
					\label{tb:oct-abnormites}\\
					\toprule
					Abnormality&Description\\
					\toprule
					
					\multicolumn{1}{l}{Central serous chorioretinopathy (CSC)}
					& \multicolumn{1}{l}{The accumulation of fluid underneath the retina.}\\
					
					\multicolumn{1}{l}{Epiretinal membrane (ERM)}
					& A thin layer of fibrous tissue forms on the surface of the retina, particularly the macula.\\
					
					\multicolumn{1}{l}{Macular hole (MH)}
					& Disruption or discontinuity in the normal retinal layers surrounding the macular hole.\\
					
					\multicolumn{1}{l}{Stargardt disease}
					& Thinning and atrophy of the retina. Disruption of photoreceptor layers. Presence of subretinal deposits.\\
					
					\multicolumn{1}{l}{Retinitis pigmentosa (RP)}
					& Thinning of the Retinal Layers. Disruption of Photoreceptor Layers. Attenuation of Retinal Vasculature.\\
					
					\multicolumn{1}{l}{Macular telangiectasia (Mactel)}
					& Abnormalities in the macular blood vessels, leading to changes in the macular structure and function\\
					
					\multicolumn{1}{l}{Diabetic macular edema (DME)}
					& The accumulation of fluid in the macula. \\
					
					\multicolumn{1}{l}{Choroidal neovascularization}
					& The abnormal growth of new blood vessels in the choroid layer.\\
					
					\multicolumn{1}{l}{Subretinal fluid}
					&  The accumulation of fluid between the neurosensory retina and the retinal pigment epithelium (RPE)\\
					
					\multicolumn{1}{l}{Intraretinal fluid}
					& The accumulation of fluid within the layers of the retina.\\
					
					\multicolumn{1}{l}{Drusen}
					& Small deposits of extracellular material that accumulate beneath the retinal pigment epithelium (RPE) or between the RPE and the photoreceptor layer in the macular region of the retina.\\
					
					\bottomrule
				\end{longtable}
			}
		}
		
		{
			\fontsize{9}{12}\selectfont
			{
				\begin{longtable}{lp{3.8in}}
					\caption{Fundus Abnormalities}
					\label{tb:fundus-ab}\\
					\toprule
					Abnormality&Description\\
					\toprule
					
					\multicolumn{1}{l}{Retinitis pigmentosa (RP)}
					& Description of RP\\
					
					\multicolumn{1}{l}{Microaneurysm}
					& Description of microaneurysm\\
					
					\multicolumn{1}{l}{Macular hole (MH)} & Full-thickness macular hole showing a surrounding cuff of subretinal fluid.\\
					
					\multicolumn{1}{l}{Hard exudate} & Yellow or Yellow-White Deposits.  Hard Borders.  Distribution.  Clustering Around Blood Vessels\\
					
					\multicolumn{1}{l}{Hemorrhage} & Small dot-like to larger blot.  Fresh hemorrhages typically appear bright red or deep red in color, indicating the presence of oxygenated blood. Over time, as the blood undergoes degradation and clotting, the hemorrhage may change color to darker red, orange, or yellowish hues.\\
					
					\multicolumn{1}{l}{Cotton wool patch / soft exudate} & White or off-white lesions.  Irregular shapes and margins.\\
					
					\multicolumn{1}{l}{Vascular abnormality} & Retinal Vessel Tortuosity.  Retinal Vessel Caliber Changes.  \\
					
					\multicolumn{1}{l}{Drusen} & Small, round or oval-shaped yellow or white deposits.\\
					
					\bottomrule
				\end{longtable}
			}
		}
		
		
		APP/website description
		GitHub repo

	\phantomsection
	\addcontentsline{toc}{section}{References}
	\newrefcontext[sorting=nyt]
	\printbibliography
	
\end{document}